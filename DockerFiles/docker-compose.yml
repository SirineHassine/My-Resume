version: '3.8'
services:
  myresumedb:
    container_name: myresumedb
    build:
      context: ./db
      #image: sirinehassine/myresumedb
    ports:
      - "3306:3306"
    volumes:
      - myresumedbdata:/var/lib/mysql
    environment:
        MYSQL_ROOT_PASSWORD: myresumepass
        TZ: Europe/Paris
    healthcheck:
      test: ["CMD", "mysql", "-u", "root", "-pmyresumepass", "--execute", "SHOW DATABASES;"]
      interval: 10s
      retries: 5
      timeout: 5s

  myresumeapp:
    container_name: myresumeapp
    build:
      context: ./app
    #image: sirinehassine/myresumeapp
    ports:
      - "8080:8080"
    volumes:
      - myresumeappdata:/usr/local/tomcat/webapps
    environment:
      MYSQL_HOST: myresumedb
      MYSQL_USER: root
      MYSQL_PASSWORD: myresumepass
      TZ: Europe/Paris
    depends_on:
      myresumedb:
        condition: service_healthy
    healthcheck:
        test: ["curl", "http://myresumeapp:8080"]
        interval: 10s
        retries: 5
        timeout: 5s
    
  myresumeweb:
    container_name: myresumeweb
    build:
      context: ./web
      #image: sirinehassine/myresumeweb
    depends_on: 
      myresumeapp:
            condition: service_healthy
    ports:
      - "80:80"
volumes:
  myresumedbdata: {}
  myresumeappdata: {}
